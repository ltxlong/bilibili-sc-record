# bilibili-sc-record
B站直播间SC记录板-实时抓取SC、同接、高能和舰长数据，可拖拽移动，可导出，可单个SC折叠，可生成图片（右键菜单），活动页可用，黑名单功能，不用登录，多种主题切换，直播全屏也在顶层显示，自动清除超过12小时的房间SC存储

# 油猴脚本
去脚本官网搜索 “B站直播间SC记录板”

# Edge浏览器
去扩展官网搜索 “B站直播间SC记录板”

# chrome浏览器（360浏览器）

如果不想用油猴脚本，而想像Edge浏览器那样的扩展的，可以：

已经将插件打包成浏览器扩展压缩包，直接下载sc_catch.zip，解压后可直接用浏览器开发者模式加载用


# diy

- 懂点代码基础的可以修改参数玩下，比如：

想要SC的记录保留长一点的时间、想要显示板的高度变更高等等。。。代码里都有参数注释


- 如果不想修改代码，而将SC记录保留的长一点：

浏览器F12，找到【应用】 

-> 存储-本地存储空间 

-> 选择https://live.bilibili.com 

-> 找到相应的 live_房间id_sc_keep_time （这个参数就是该房间最后一条SC的时间）

-> 右键，选择删除

这样，全部的直播间，在下一次进入任意一个直播间，并且还要相隔12小时之后，才会触发清理该直播间的SC存储



# 版本更新时候，本tampermonkey脚本转edge脚本：
1、去掉开头的==UserScript==注释

2、将全部unsafeWindow替换为window

3、删除GM_registerMenuCommand函数

4、修改manifest.json

5、修改_locales/zh_CN目录里面的messages.json

6、图片资源需要修改的


# 关于同接和高能

插件的同接和高能数据不是计算的，而是直播间原本的websocket包的实时动态数据，

同接是指高能榜上的非0贡献人数，高能是指高能榜的在线所有人数，而手机上显示的是高能数。

有很多人将手机上显示的高能数称为同接，但我觉得，高能数里面的非0贡献人数才是最接近原来同接数的。


# 关于获取roomId
3.0.0 版本开始用 window.BilibiliLive 里面的roomId，

但是遇到了一个问题，就是在Edge里面扩展和页面的window对象是隔离的，

试过了很多种方法都获取不到页面的 window.BilibiliLive，最后只能放弃了，

换回直接通过url来获取roomId的通用方法（前提是match写的好）

最后成了4.0.0版本，改用通用方法的好处是：从油猴脚本修改为Edge扩展很简单

（从5.0.0开始的时候，其实已经可以实现Edge也用window.BilibiliLive来获取roomId，但match的方法太简单了，就一直用match来获取roomId了）



### 一个小现象：

版本2.0.0以及之后，引入了html2canvas.js来实现生成图片功能

生成图片的时候会被动触发B站 bmgOnLoad undefined错误，在浏览器控制台可以看到（130个）

但是，没有啥影响，对于网站和插件来说都没有影响，生成图片功能没影响，也没错误。

只不过在控制台显示这些额外的错误而已，生成一次，显示130个，不看的话完全无所谓。

试过很多种方法，拦截，覆盖，都失败了，还是一样的触发，那就这样吧，反正完全没影响。


